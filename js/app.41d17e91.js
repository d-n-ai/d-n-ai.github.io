(()=>{"use strict";var e={5591:(e,t,r)=>{var a,o=r(1957),s=r(3890),n=r(499),i=r(9835);function l(e,t,r,a,o,s){const n=(0,i.up)("router-view");return(0,i.wg)(),(0,i.j4)(n)}(function(e){e["select"]="select",e["generation"]="generation",e["preview"]="preview",e["errorPhoto"]="errorPhoto"})(a||(a={}));var c=r(3276),u=r(8985);async function h(e){return new Promise((t=>setTimeout(t,1e3*e)))}function p(e){var t=e.split(","),r="image/jpg",a=atob(t[1]),o=a.length,s=new Uint8Array(o);while(o--)s[o]=a.charCodeAt(o);return new Blob([s],{type:r})}const d=(0,i.aZ)({name:"App",data(){return{version:"0.0.1",phase:a.select,apiBaseUrl:"http://0542-35-204-89-110.ngrok-free.app",prompt:"",photoUrl:"",selfieDataUrl:null,generationBySelfie:!1,debug:!0,subscription:null,supabase:null,supabaseData:{url:"https://zcsptrbqqqbhfuszvuve.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inpjc3B0cmJxcXFiaGZ1c3p2dXZlIiwicm9sZSI6ImFub24iLCJpYXQiOjE2ODI4NjEwMzYsImV4cCI6MTk5ODQzNzAzNn0.JE3zy8-RWIMnB3P1ye46aGtDVD_IGMUArfuKA00Q8EQ"},user:null}},setup(){const{locale:e}=(0,c.QT)({useScope:"global"});return{locale:e}},computed:{api(){return{photo:`${this.apiBaseUrl}/photo`}},isLoggedIn(){return null!==this.user}},async created(){this.locale=window.navigator.language,this.apiBaseUrl=window.location.origin,"http://localhost:8080"!==window.location.origin&&(this.debug=!1),window.debug=()=>{this.debug=!this.debug},this._loadSelfie(),this._setAuth(),window.setTimeout((()=>{this.getAccount()}),100)},async beforeUnmount(){this.supabase.removeAllChannels()},methods:{async createPhoto(e){console.log(e),this.generationBySelfie=!1,this.prompt=e,this.phase=a.generation,await this.sendPromptToSupabase(e)},async createPhotoBySelfie(e,t){console.log("createPhotoBySelfie",e),this.generationBySelfie=!0,this.prompt=e,this.phase=a.generation,await this.sendPromptToSupabase(e,t)},toSelect(){this.phase=a.select},async uploadSelfieToSupabase(){const e=p(this.selfieDataUrl),{error:t}=await this.supabase.storage.from("selfies").upload(`${this.user.id}.jpg`,e,{cacheControl:"3600",upsert:!0});t&&console.log("error",t)},async sendPromptToSupabase(e,t=null){const r=await this.supabase.auth.getUser();console.log("sendMessage, text, userData",r);let a={user_id:this.user.id,prompt:e};t&&(a={...a,selfie_weight:t,selfie:!0});const{data:o,error:s}=await this.supabase.from("generations").insert(a).select("id");s&&console.log("error",s),await this.supabase.removeAllChannels();const n=o[0].id;await this._subscribeForGeneration(n)},async _subscribeForGeneration(e){this.subscription=await this.supabase.channel("any").on("postgres_changes",{event:"UPDATE",schema:"public",table:"generations",filter:`id=eq.${e}`},(async e=>{console.log("Change received!",e),null!==e?.new?.result_url&&(this.photoUrl=e?.new?.result_url,this.phase=a.preview,await this.supabase.removeAllChannels())})).subscribe()},async _getPhotoUrlByPromptBySelfie(e,t){if(this.debug)return console.log(e),await h(1),this.photoUrl="https://picsum.photos/512",void(this.phase=a.preview);try{const r=p(this.selfieDataUrl);console.log(r);const o=new File([r],"test.jpg",{type:"image/jpeg"}),s=new FormData;s.append("selfie",o),s.append("prompt",e),s.append("weight",`${t}`);const n=await window.fetch(`${this.apiBaseUrl}/selfie`,{method:"POST",body:s});if(!n.ok)throw new Error(`An error has occured: ${n.status}`);const i=await n.json();if(console.log(i),"ready"!==i.generationStatus)throw console.error("API fall, fetchResponse, data",n,i),new Error("not ready");this.photoUrl=`${this.apiBaseUrl}/${i.image}`,this.phase=a.preview}catch(r){console.log("Fetch error: ",r),this.photoUrl="",this.phase=a.errorPhoto}},async _getPhotoUrlByPrompt(e){if(this.debug)return console.log(e),await h(3),this.photoUrl="https://picsum.photos/512",void(this.phase=a.preview);try{const t=await window.fetch(this.api.photo,{method:"POST",body:JSON.stringify({prompt:e})});if(!t.ok)throw new Error(`An error has occured: ${t.status}`);const r=await t.json();if(console.log(r),"ready"!==r.generationStatus)throw console.error("API fall, fetchResponse, data",t,r),new Error("not ready");this.photoUrl=`${this.apiBaseUrl}/${r.image}`,this.phase=a.preview}catch(t){console.log("Fetch error: ",t),this.photoUrl="",this.phase=a.errorPhoto}},async login(e,t){let{data:r,error:a}=await this.supabase.auth.signInWithPassword({email:e,password:t});console.log("login, { data, error }",{data:r,error:a})},async signUp(e,t){let{data:r,error:a}=await this.supabase.auth.signUp({email:e,password:t});console.log("signUp, { data, error }",{data:r,error:a})},async getAccount(){const e=localStorage.getItem("anonymAccEmail"),t=localStorage.getItem("anonymAccPass");e&&t?await this.login(e,t):this.createAnonymAccount()},async cancelOldTasks(){const{error:e}=await this.supabase.from("generations").update({canceled:!0}).eq("user_id",this.user.id).eq("done",!1).eq("canceled",!1);e&&console.log("error")},async createAnonymAccount(){const e=`${crypto.randomUUID()}@anonym.com`,t=crypto.randomUUID();localStorage.setItem("anonymAccEmail",e),localStorage.setItem("anonymAccPass",t),await this.signUp(e,t)},_loadSelfie(){const e=localStorage.getItem("selfie");e&&(this.selfieDataUrl=e)},_setAuth(){this.supabase=(0,u.eI)(this.supabaseData.url,this.supabaseData.anonKey),this.supabase.auth.onAuthStateChange(((e,t)=>{t?(console.log("session.user",t.user.email),this.user=t?t.user:null):(console.log("auth no session"),this.user=null)}))},async TMP_test(){console.log("this.subscription",this.subscription)},async TMP_listData(){const{data:e,error:t}=await this.supabase.from("generations").select();console.log("listData, { data, error }",{data:e,error:t})},async TMP_upload(e){console.log(e.target.files[0]);const{data:t,error:r}=await this.supabase.storage.from("files").upload("t/avatar1.jpg",e.target.files[0],{cacheControl:"3600",upsert:!1});console.log("listBuckets, { data, error }",{data:t,error:r})},async TMP_logOut(){let{error:e}=await this.supabase.auth.signOut();console.log("logOut, error",e)}}});var f=r(1639);const g=(0,f.Z)(d,[["render",l]]),m=g;var b=r(3340),y=r(8339);const w=[{path:"/",component:()=>Promise.all([r.e(736),r.e(446)]).then(r.bind(r,5446))},{path:"/ai",component:()=>Promise.all([r.e(736),r.e(936)]).then(r.bind(r,8936)),children:[{path:"",component:()=>Promise.all([r.e(736),r.e(292)]).then(r.bind(r,1292))}]},{path:"/character-sheet",component:()=>Promise.all([r.e(736),r.e(649)]).then(r.bind(r,9649))},{path:"/:catchAll(.*)*",component:()=>Promise.all([r.e(736),r.e(431)]).then(r.bind(r,9431))}],v=w,P=(0,b.BC)((function(){const e=y.PO,t=(0,y.p7)({scrollBehavior:()=>({left:0,top:0}),routes:v,history:e("/")});return t}));async function S(e,t){const r=e(m);r.use(s.Z,t);const a=(0,n.Xl)("function"===typeof P?await P({}):P);return{app:r,router:a}}const A={config:{}},I="/";async function O({app:e,router:t},r){let a=!1;const o=e=>{try{return t.resolve(e).href}catch(r){}return Object(e)===e?null:e},s=e=>{if(a=!0,"string"===typeof e&&/^https?:\/\//.test(e))return void(window.location.href=e);const t=o(e);null!==t&&(window.location.href=t)},n=window.location.href.replace(window.location.origin,"");for(let l=0;!1===a&&l<r.length;l++)try{await r[l]({app:e,router:t,ssrContext:null,redirect:s,urlPath:n,publicPath:I})}catch(i){return i&&i.url?void s(i.url):void console.error("[Quasar] boot error:",i)}!0!==a&&(e.use(t),e.mount("#q-app"))}S(o.ri,A).then((e=>{const[t,a]=void 0!==Promise.allSettled?["allSettled",e=>e.map((e=>{if("rejected"!==e.status)return e.value.default;console.error("[Quasar] boot error:",e.reason)}))]:["all",e=>e.map((e=>e.default))];return Promise[t]([Promise.resolve().then(r.bind(r,633))]).then((t=>{const r=a(t).filter((e=>"function"===typeof e));O(e,r)}))}))},633:(e,t,r)=>{r.r(t),r.d(t,{default:()=>i});var a=r(3276);const o={},s={"Generate DnD character by selfie with AI":"ИИ генератор DnD персонажа по селфи",Start:"Начать","Choose race and class":"Выберите расу и класс","Select your character parameters - race, class, gender, allegement and other. Any parameter can be left empty":"Выберите параметры своего персонажа - расу, класс, пол, мировозрение. Любой параметр можно не выбирать","Press GENERATE button and AI will do a magic - you will see character portrait. If anything not satisfy you, feel free to generate new one or change parameters":"Нажмите кнопку СОЗДАТЬ и искусственный интеллект нарисует портрет персонажа. Если картинка не понравилась, можно сгенерировать новую, или изменить параметры персонажа","If you like the portrait, press next and download character list with this photo. Your hero ready to adventures!":"Если портрет персонажа Вам понравился, нажмите «Далее» и распечатайте лист персонажа для DnD. Ваш герой готов к приключениям!","Generate character portrait":"ИИ нарисует персонажа","Generate character list":"Распечатайте лист персонажа","Take a selfie (optional)":"Сделайте селфи (не обязательно)","If you want character picture with face like yours, take a selfie. It photo will be used as basis for generating image. You can skip this step and generate it only by race, class and other parameters":"Если Вы хотите чтобы лицо персонажа было похоже а Ваше, сделайте селфи - изображение будет генерироваться на его основе. Этот шаг не обязателен, достаточно использовать расу, класс и другие параметры","Select your character parameters":"Выберите параметры своего персонажа","Any parameter can be left empty":"Любые поля можно не заполнять",generate:"создать",save:"сохранить","generate new":"другая картинка","change parameters":"параметры персонажа",continue:"лист персонажа",race:"раса",class:"класс",sex:"пол",goodness:"мировозрение",chaoticness:"законопослушность",style:"стиль","other features (optional)":"Особенности (необязательно)",Examples:"Примеры","Generate by selfie":"Создать по селфи","All other options will be applied":"Все параметры персонажа применятся","take a selfie":"сделать селфи","change selfie":"изменить селфи","Selfie impact":"Влияние селфи","Getting access to camera":"Получаем доступ к камере",selfie:"селфи","If you want only male/female, return back and choose character gender":"Если нужен определенный пол персонажа, его можно выбрать на предыдущем шаге"},n={"en-US":o,ru:s},i=({app:e})=>{const t=(0,a.o)({locale:"ru",globalInjection:!0,legacy:!1,fallbackLocale:"en-US",messages:n});e.use(t)}}},t={};function r(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a].call(s.exports,s,s.exports,r),s.exports}r.m=e,(()=>{var e=[];r.O=(t,a,o,s)=>{if(!a){var n=1/0;for(u=0;u<e.length;u++){for(var[a,o,s]=e[u],i=!0,l=0;l<a.length;l++)(!1&s||n>=s)&&Object.keys(r.O).every((e=>r.O[e](a[l])))?a.splice(l--,1):(i=!1,s<n&&(n=s));if(i){e.splice(u--,1);var c=o();void 0!==c&&(t=c)}}return t}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[a,o,s]}})(),(()=>{r.n=e=>{var t=e&&e.__esModule?()=>e["default"]:()=>e;return r.d(t,{a:t}),t}})(),(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(a,o){if(1&o&&(a=this(a)),8&o)return a;if("object"===typeof a&&a){if(4&o&&a.__esModule)return a;if(16&o&&"function"===typeof a.then)return a}var s=Object.create(null);r.r(s);var n={};e=e||[null,t({}),t([]),t(t)];for(var i=2&o&&a;"object"==typeof i&&!~e.indexOf(i);i=t(i))Object.getOwnPropertyNames(i).forEach((e=>n[e]=()=>a[e]));return n["default"]=()=>a,r.d(s,n),s}})(),(()=>{r.d=(e,t)=>{for(var a in t)r.o(t,a)&&!r.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}})(),(()=>{r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,a)=>(r.f[a](e,t),t)),[]))})(),(()=>{r.u=e=>"js/"+e+"."+{292:"fd71b18b",431:"839b8b77",446:"3b3bec3f",649:"89a07fe9",936:"a3a9f30e"}[e]+".js"})(),(()=>{r.miniCssF=e=>"css/"+e+"."+{292:"fd4e57ad",649:"e4f51559"}[e]+".css"})(),(()=>{r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t)})(),(()=>{var e={},t="quasar-project:";r.l=(a,o,s,n)=>{if(e[a])e[a].push(o);else{var i,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var h=c[u];if(h.getAttribute("src")==a||h.getAttribute("data-webpack")==t+s){i=h;break}}i||(l=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,r.nc&&i.setAttribute("nonce",r.nc),i.setAttribute("data-webpack",t+s),i.src=a),e[a]=[o];var p=(t,r)=>{i.onerror=i.onload=null,clearTimeout(d);var o=e[a];if(delete e[a],i.parentNode&&i.parentNode.removeChild(i),o&&o.forEach((e=>e(r))),t)return t(r)},d=setTimeout(p.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=p.bind(null,i.onerror),i.onload=p.bind(null,i.onload),l&&document.head.appendChild(i)}}})(),(()=>{r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{r.p="/"})(),(()=>{if("undefined"!==typeof document){var e=(e,t,r,a,o)=>{var s=document.createElement("link");s.rel="stylesheet",s.type="text/css";var n=r=>{if(s.onerror=s.onload=null,"load"===r.type)a();else{var n=r&&("load"===r.type?"missing":r.type),i=r&&r.target&&r.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+i+")");l.code="CSS_CHUNK_LOAD_FAILED",l.type=n,l.request=i,s.parentNode.removeChild(s),o(l)}};return s.onerror=s.onload=n,s.href=t,r?r.parentNode.insertBefore(s,r.nextSibling):document.head.appendChild(s),s},t=(e,t)=>{for(var r=document.getElementsByTagName("link"),a=0;a<r.length;a++){var o=r[a],s=o.getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(s===e||s===t))return o}var n=document.getElementsByTagName("style");for(a=0;a<n.length;a++){o=n[a],s=o.getAttribute("data-href");if(s===e||s===t)return o}},a=a=>new Promise(((o,s)=>{var n=r.miniCssF(a),i=r.p+n;if(t(n,i))return o();e(a,i,null,o,s)})),o={143:0};r.f.miniCss=(e,t)=>{var r={292:1,649:1};o[e]?t.push(o[e]):0!==o[e]&&r[e]&&t.push(o[e]=a(e).then((()=>{o[e]=0}),(t=>{throw delete o[e],t})))}}})(),(()=>{var e={143:0};r.f.j=(t,a)=>{var o=r.o(e,t)?e[t]:void 0;if(0!==o)if(o)a.push(o[2]);else{var s=new Promise(((r,a)=>o=e[t]=[r,a]));a.push(o[2]=s);var n=r.p+r.u(t),i=new Error,l=a=>{if(r.o(e,t)&&(o=e[t],0!==o&&(e[t]=void 0),o)){var s=a&&("load"===a.type?"missing":a.type),n=a&&a.target&&a.target.src;i.message="Loading chunk "+t+" failed.\n("+s+": "+n+")",i.name="ChunkLoadError",i.type=s,i.request=n,o[1](i)}};r.l(n,l,"chunk-"+t,t)}},r.O.j=t=>0===e[t];var t=(t,a)=>{var o,s,[n,i,l]=a,c=0;if(n.some((t=>0!==e[t]))){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(l)var u=l(r)}for(t&&t(a);c<n.length;c++)s=n[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0;return r.O(u)},a=globalThis["webpackChunkquasar_project"]=globalThis["webpackChunkquasar_project"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))})();var a=r.O(void 0,[736],(()=>r(5591)));a=r.O(a)})();